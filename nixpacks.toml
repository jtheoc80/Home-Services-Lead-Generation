[variables]
PYTHON_VERSION = "3.11"

# Explicitly configure providers to disable auto-detection
[providers.python]

[phases.setup]
nixPkgs = ["python311", "poetry", "postgresql"]

[phases.install]
cmds = [
  "ln -sf /nix/var/nix/profiles/default/bin/python3.11 /usr/local/bin/python3",
  "ln -sf /nix/var/nix/profiles/default/bin/python3.11 /usr/local/bin/python",
  "python --version",
  "python -m pip install poetry",
  "poetry config virtualenvs.create false",
  "poetry install --without dev --no-interaction --no-ansi"
]

[phases.build]
# Explicitly set build to do nothing - no npm build needed for backend
cmds = ["echo 'Backend build complete - no additional build steps needed'"]

[start]
cmd = "cd /app/backend && PYTHONPATH=/app SERVICE_TYPE=backend poetry run python main.py"