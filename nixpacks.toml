[variables]
PYTHON_VERSION = "3.11"

[phases.setup]
nixPkgs = ["python311", "poetry", "nodejs_20", "postgresql"]

[phases.install]
cmds = [
  "ln -sf /nix/var/nix/profiles/default/bin/python3.11 /usr/local/bin/python3",
  "ln -sf /nix/var/nix/profiles/default/bin/python3.11 /usr/local/bin/python",
  "python --version",
  "python -m pip install poetry",
  "poetry config virtualenvs.create false",
  "poetry install --without dev --no-interaction --no-ansi",
  "npm ci"
]

[phases.build]
cmds = ["npm run build"]

[start]
cmd = "SERVICE_TYPE=backend poetry run python backend/main.py"